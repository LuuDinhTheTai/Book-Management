<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>BM</title>
    <link rel="stylesheet" th:href="@{/style.css}"/>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
</head>
<body>
<div th:replace="component/navbar :: navbar"></div>
<div class="container">
    <h1 class="page-title">Cart Detail</h1>

    <div th:if="${successMessage}" class="success">
        <p th:text="${successMessage}"></p>
    </div>
    
    <div th:if="${errorMessage}" class="error">
        <p th:text="${errorMessage}"></p>
    </div>

    <div th:if="${cart != null}">
        <div class="cart-info">
            <p><strong>Cart ID:</strong> <span th:text="${cart.id}"></span></p>
            <p><strong>Total Price:</strong> <span th:text="${cart.totalPrice + 'ƒë'}"></span></p>
        </div>

        <div th:if="${#lists.isEmpty(cart.cartBooks)}" class="empty-cart">
            <p>This cart is empty.</p>
                            <a th:href="@{/books/}" class="btn-link">Add Some Books</a>
        </div>

        <div th:if="${!#lists.isEmpty(cart.cartBooks)}">
            <h2>Cart Items</h2>
            <table class="table">
                <thead>
                <tr>
                    <th>Book</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Total</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="cartBook : ${cart.cartBooks}">
                    <td>
                        <a th:href="@{/books/{id}(id=${cartBook.book.id})}" th:text="${cartBook.book.name}"></a>
                    </td>
                    <td th:text="${cartBook.book.price + 'ƒë'}"></td>
                    <td>
                        <div class="quantity-controls">
                            <form th:action="@{/carts/decrease-item/{id}(id=${cartBook.id})}" method="post" style="display: inline;">
                                <input type="hidden" name="qty" th:value="1">
                                <button type="submit" class="btn-small btn-minus">-</button>
                            </form>
                            <span class="quantity-display" th:text="${cartBook.qty}"></span>
                            <form th:action="@{/carts/increase-item/{id}(id=${cartBook.id})}" method="post" style="display: inline;">
                                <input type="hidden" name="qty" th:value="1">
                                <button type="submit" class="btn-small btn-plus">+</button>
                            </form>
                        </div>
                    </td>
                    <td th:text="${cartBook.price + 'ƒë'}"></td>
                </tr>
                </tbody>
            </table>

            <div class="cart-summary">
                <h2>Total: <span th:text="${cart.totalPrice + 'ƒë'}"></span></h2>
            </div>

            <div class="cart-actions">
                <a th:href="@{/books/}" class="btn-link">Continue Shopping</a>
            </div>
        </div>
    </div>

    <div class="back-link">
        <a th:href="@{/carts/list}" class="btn-link">‚Üê Back to Cart List</a>
    </div>
</div>
</body>
</html>