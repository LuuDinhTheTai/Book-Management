<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Orders - BookStore</title>
    <link rel="stylesheet" th:href="@{/style.css}"/>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>📚</text></svg>">
</head>
<body>
<div th:replace="component/navbar :: navbar"></div>

<div class="container">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">My Orders</h1>
            <p class="page-subtitle">Review your completed orders</p>
        </div>

        <div class="header-actions">
            <a th:href="@{/carts/list}" class="btn btn-primary">
                <span class="btn-icon">🛒</span>
                View Active Carts
            </a>
        </div>
    </div>

    <div th:if="${errorMessage}" class="alert alert-error">
        <span class="alert-icon">⚠️</span>
        <span th:text="${errorMessage}"></span>
    </div>

    <div th:if="${successMessage}" class="alert alert-success">
        <span class="alert-icon">✅</span>
        <span th:text="${successMessage}"></span>
    </div>

    <!-- Orders Summary -->
    <div th:object="${orders}" class="orders-summary-section">
        <div class="summary-stats">
            <div class="stat-item">
                <span class="stat-icon">📦</span>
                <span class="stat-label">Total Orders:</span>
                <span class="stat-value" th:text="${orders.totalElements}"></span>
            </div>
        </div>
    </div>

    <!-- Orders List -->
    <div th:if="${orders.content.size() > 0}" class="orders-container">
        <div th:each="order : ${orders.content}" class="order-card">
            <div class="order-header">
                <div class="order-info">
                    <h3 class="order-title">Order #<span th:text="${order.id}"></span></h3>
                    <div class="order-meta">
                        <span class="order-status" 
                              th:class="${order.status == 'Completed' ? 'status-completed' : 'status-processing'}"
                              th:text="${order.status}"></span>
                    </div>
                </div>
            </div>

            <!-- Order Items -->
            <div th:if="${order.cartBooks.size() > 0}" class="order-items">
                <div th:each="orderItem : ${order.cartBooks}" class="order-item">
                    <div class="item-image">
                        <div class="book-placeholder-small">📚</div>
                    </div>

                    <div class="item-info">
                        <h4 class="item-title">
                            <a th:href="@{|/books/${orderItem.book.id}|}" th:text="${orderItem.book.name}"></a>
                        </h4>

                        <div class="item-meta">
                            <span class="item-price" th:text="'$' + ${orderItem.book.price}"></span>
                            <span class="item-quantity" th:text="'Qty: ' + ${orderItem.qty}"></span>
                        </div>
                    </div>

                    <div class="item-total">
                        <span class="total-amount" th:text="'$' + ${orderItem.qty * orderItem.book.price}"></span>
                    </div>
                </div>
            </div>

            <!-- Empty Order -->
            <div th:if="${order.cartBooks.size() == 0}" class="empty-order">
                <div class="empty-icon">📦</div>
                <p class="empty-text">This order is empty</p>
            </div>

            <!-- Order Summary -->
            <div th:if="${order.cartBooks.size() > 0}" class="order-total">
                <div class="total-row">
                    <span class="total-label">Items:</span>
                    <span class="total-value" th:text="${order.cartBooks.size()} + ' books'"></span>
                </div>
                <div class="total-row">
                    <span class="total-label">Total Amount:</span>
                    <span class="total-value" th:text="'$' + ${order.totalPrice}"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div th:if="${orders.content.size() == 0}" class="empty-state">
        <div class="empty-icon">📦</div>
        <h3 class="empty-title">No orders found</h3>
        <p class="empty-message">You haven't placed any orders yet</p>
        <div class="empty-actions">
            <a th:href="@{/books/list}" class="btn btn-primary">
                <span class="btn-icon">📚</span>
                Browse Books
            </a>
            <a th:href="@{/carts/list}" class="btn btn-outline">
                <span class="btn-icon">🛒</span>
                View Carts
            </a>
        </div>
    </div>

    <!-- Pagination -->
    <div th:if="${orders.totalPages > 1}" class="pagination">
        <div class="pagination-info">
            <span>Showing page <span th:text="${orders.number + 1}"></span> of <span th:text="${orders.totalPages}"></span></span>
        </div>
        
        <div class="pagination-controls">
            <a th:if="${orders.hasPrevious()}" 
               th:href="@{/orders/list(page=${orders.number - 1}, size=${orders.size})}" 
               class="btn btn-outline btn-small">Previous</a>
            
            <span th:each="pageNum : ${#numbers.sequence(0, orders.totalPages - 1)}" 
                  th:if="${pageNum >= orders.number - 2 and pageNum <= orders.number + 2}">
                <a th:href="@{/orders/list(page=${pageNum}, size=${orders.size})}" 
                   th:text="${pageNum + 1}"
                   th:class="${pageNum == orders.number ? 'btn btn-primary btn-small' : 'btn btn-outline btn-small'}"></a>
            </span>
            
            <a th:if="${orders.hasNext()}" 
               th:href="@{/orders/list(page=${orders.number + 1}, size=${orders.size})}" 
               class="btn btn-outline btn-small">Next</a>
        </div>
    </div>
</div>
</body>
</html>